<?xml version='1.0' encoding='UTF-8'?>
<kml xmlns='http://www.opengis.net/kml/2.2'>
  <Document>
    <name>StadtPanoramen - 360° Panoramas of Germany </name>
    <Style id="styleCamera">
      <IconStyle>
        <Icon>
          <href>http://maps.google.com/mapfiles/kml/shapes/camera.png</href>
        </Icon>
      </IconStyle>
    </Style>
      <Folder>        
      <name>StadtPanoramen </name>
      <% City.order(:name).all.each do |city| %>
      <% unless city.name != "Berlin" and city.name != "Dresden" and city.name != "Düsseldorf"  and city.name != "Frankfurt" and city.name != "Freiburg" and city.name != "Hamburg" and city.name != "Heidelberg" and city.name != "Köln" and city.name != "München"  %>
        <% city_filename = FileHelper.to_filename city.name %>
        <% city_en_filename = FileHelper.to_filename city.en_name %>        
        <% sortedPanoramas = city.panoramas %>
        <% sortedPanoramas.sort_by!{ |p| (p.district.blank? ? "0_" : p.district) + (p.location.blank? ? "0_" : p.location) + p.name } %>
        <% sortedPanoramas.each do |pano| %>
          <% pano_filename = FileHelper.to_filename pano.name %>
          <% pano_en_filename = FileHelper.to_filename( pano.en_name.blank? ? pano.name : pano.en_name ) %>          
          <% unless pano.get_latitude == "0.000000" %>    
          <% panoenname = (pano.alt_en_name.blank? ? (pano.en_name.blank? ? (pano.name) : (pano.en_name)) : (pano.alt_en_name)) %>
          <% panoname = (pano.alt_name.blank? ? (pano.name) : (pano.alt_name)) %>
          <% pano_loc = (pano.location.blank? ? ("") : (pano.location + " in")) %>
          <% pano_dist = (pano.district.blank? ? ("") : (pano.district)) %>
          <Placemark id="<%= pano.name %> <%= pano_loc %> <%= pano_dist %> <%= city.name %>"> 
            <name><%= city.name %> <%= pano.name %> <%= pano_loc %> <%= pano_dist %> </name>
            <ExtendedData>
              <Data name='gx_media_links'>
              <value>http://panorama-cities.net/<%= city_en_filename %>/panoramas/<%= pano_filename %>_<%= city_filename %>.jpg</value>
              </Data>
            </ExtendedData>
            <description>
              <![CDATA[<%= (pano.repeative == true) ? ("-------------- 360° Panorama -------------- ") : ("") %> 
               http://www.stadtpanoramen.de/<%= city_filename %>/<%= pano_filename %>.html]]>
            </description>
            <styleUrl>#styleCamera</styleUrl>
            <Point>
              <coordinates><%= pano.longitude %>,<%= pano.latitude %></coordinates>
            </Point>
          </Placemark>
          <% end %>
        <% end %>
       <% end %>
       <% end %>
      </Folder>  
  </Document>
</kml>